================================ CT Integration  on TKG Envirnment SOP  ====================

devops@DAPDTNZBTXX1001 ~]$ cd colortokens/
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ ls
colortoken.txt
[devops@DAPDTNZBTXX1001 colortokens]$ cat colortoken.txt
export HELM_EXPERIMENTAL_OCI=1

helm -n ct-system install ct-contsec oci://daregistry.bankofbaroda.co.in:9443/colortokens/helm/ct-contsec/ --version 24.9.2 --set global.colortokensDomainSuffix=https://colortokensdr.bankofbaroda.co.in --set global.clusterIdentifier=dapdtnzwcxx1002 --set global.colortokensAuthKey=4y4vyfbdejteq --set global.service.classicMode="false" --set global.registryAccount=daregistry.bankofbaroda.co.in/colortokens

$ helm registry login daregistry.bankofbaroda.co.in:9443 -u admin
helm -n ct-system uninstall ct-contsec --no-hooks

export HELM_EXPERIMENTAL_OCI=1
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ k get no
NAME                                            STATUS   ROLES           AGE   VERSION
dapdtnzwcxx1001-jdjbs-22c97                     Ready    control-plane   64d   v1.31.4+vmware.1-fips
dapdtnzwcxx1001-jdjbs-67dtt                     Ready    control-plane   64d   v1.31.4+vmware.1-fips
dapdtnzwcxx1001-jdjbs-zgkc7                     Ready    control-plane   64d   v1.31.4+vmware.1-fips
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-dns5n   Ready    <none>          43d   v1.31.4+vmware.1-fips
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-h9wtn   Ready    <none>          43d   v1.31.4+vmware.1-fips
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-pqn54   Ready    <none>          43d   v1.31.4+vmware.1-fips
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-tbrrq   Ready    <none>          18d   v1.31.4+vmware.1-fips
[devops@DAPDTNZBTXX1001 colortokens]$ k get ns
NAME                                 STATUS   AGE
app                                  Active   96d
cert-manager                         Active   162d
default                              Active   176d
digital-ns                           Active   3d23h
istio-system                         Active   161d
kong-cp                              Active   19d
kong-dev-portal                      Active   19d
kong-dp                              Active   19d
kong-eg-cp                           Active   18d
kong-eg-dp                           Active   18d
kube-node-lease                      Active   176d
kube-public                          Active   176d
kube-system                          Active   176d
monitoring                           Active   22d
nginx-image-store                    Active   17m
nginxplus                            Active   24m
prometheus                           Active   16d
secretgen-controller                 Active   176d
tanzu-system-ingress                 Active   162d
tkg-system                           Active   176d
velero                               Active   4d21h
velero-vsphere-plugin-backupdriver   Active   176d
vmware-system-antrea                 Active   176d
vmware-system-auth                   Active   176d
vmware-system-cloud-provider         Active   176d
vmware-system-csi                    Active   176d
vmware-system-tkg                    Active   176d
[devops@DAPDTNZBTXX1001 colortokens]$ helm get values istio -n istio-system
USER-SUPPLIED VALUES:
_internal_defaults_do_not_set:
  affinity: {}
  autoscaleBehavior: {}
  autoscaleEnabled: true
  autoscaleMax: 5
  autoscaleMin: 1
  base:
    enableIstioConfigCRDs: true
  cni:
    enabled: false
    provider: default
  configMap: true
  cpu:
    targetAverageUtilization: 80
  deploymentLabels: {}
  env: {}
  experimental:
    stableValidationPolicy: false
  extraContainerArgs: []
  gateways:
    seccompProfile: {}
    securityContext: {}
  global:
    caAddress: ""
    caName: ""
    certSigners: []
    configCluster: false
    configValidation: true
    defaultPodDisruptionBudget:
      enabled: true
    defaultResources:
      requests:
        cpu: 10m
    externalIstiod: false
    hub: docker.io/istio
    imagePullPolicy: ""
    imagePullSecrets: []
    istioNamespace: istio-system
    istiod:
      enableAnalysis: false
    logAsJson: false
    logging:
      level: default:info
    meshID: ""
    meshNetworks: {}
    mountMtlsCerts: false
    multiCluster:
      clusterName: ""
      enabled: false
    network: ""
    omitSidecarInjectorConfigMap: false
    operatorManageWebhooks: false
    pilotCertProvider: istiod
    priorityClassName: ""
    proxy:
      autoInject: enabled
      clusterDomain: cluster.local
      componentLogLevel: misc:error
      excludeIPRanges: ""
      excludeInboundPorts: ""
      excludeOutboundPorts: ""
      image: proxyv2
      includeIPRanges: '*'
      includeInboundPorts: '*'
      includeOutboundPorts: ""
      logLevel: warning
      outlierLogPath: ""
      privileged: false
      readinessFailureThreshold: 4
      readinessInitialDelaySeconds: 0
      readinessPeriodSeconds: 15
      resources:
        limits:
          cpu: 2000m
          memory: 1024Mi
        requests:
          cpu: 100m
          memory: 128Mi
      startupProbe:
        enabled: true
        failureThreshold: 600
      statusPort: 15020
      tracer: none
    proxy_init:
      forceApplyIptables: false
      image: proxyv2
    remotePilotAddress: ""
    sds:
      token:
        aud: istio-ca
    sts:
      servicePort: 0
    tag: 1.25.2
    variant: ""
    waypoint:
      affinity: {}
      nodeSelector: {}
      resources:
        limits:
          cpu: "2"
          memory: 1Gi
        requests:
          cpu: 100m
          memory: 128Mi
      tolerations: []
      topologySpreadConstraints: []
  hub: danmjfgwnxx0001.bankofbaroda.co.in:9443/istio/
  image: danmjfgwnxx0001.bankofbaroda.co.in:9443/istio/pilot:1.25.2
  initContainers: []
  ipFamilies: []
  ipFamilyPolicy: ""
  istiodRemote:
    enabled: false
    injectionCABundle: ""
    injectionPath: /inject
    injectionURL: ""
  jwksResolverExtraRootCA: ""
  keepaliveMaxServerConnectionAge: 30m
  memory: {}
  meshConfig:
    enablePrometheusMerge: true
  nodeSelector: {}
  ownerName: ""
  podAnnotations: {}
  podLabels: {}
  replicaCount: 1
  resources:
    requests:
      cpu: 500m
      memory: 2048Mi
  revision: ""
  revisionTags: []
  rollingMaxSurge: 100%
  rollingMaxUnavailable: 25%
  seccompProfile: {}
  serviceAccountAnnotations: {}
  serviceAnnotations: {}
  sidecarInjectorWebhook:
    alwaysInjectSelector: []
    defaultTemplates: []
    enableNamespacesByDefault: false
    injectedAnnotations: {}
    neverInjectSelector: []
    reinvocationPolicy: Never
    rewriteAppHTTPProbe: true
    templates: {}
  sidecarInjectorWebhookAnnotations: {}
  tag: 1.25.2
  taint:
    enabled: false
    namespace: ""
  telemetry:
    enabled: true
    v2:
      enabled: true
      prometheus:
        enabled: true
      stackdriver:
        enabled: false
  tolerations: []
  topologySpreadConstraints: []
  traceSampling: 1
  trustedZtunnelName: ""
  trustedZtunnelNamespace: ""
  variant: ""
  volumeMounts: []
  volumes: []
[devops@DAPDTNZBTXX1001 colortokens]$ helm get values istio -n istio-system | grep profile
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$  k top no
NAME                                            CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
dapdtnzwcxx1001-jdjbs-22c97                     272m         3%     3274Mi          5%
dapdtnzwcxx1001-jdjbs-67dtt                     223m         2%     2659Mi          4%
dapdtnzwcxx1001-jdjbs-zgkc7                     185m         2%     2487Mi          4%
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-dns5n   248m         1%     5884Mi          13%
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-h9wtn   1143m        4%     4531Mi          10%
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-pqn54   180m         0%     4364Mi          10%
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-tbrrq   184m         0%     3695Mi          8%
[devops@DAPDTNZBTXX1001 colortokens]$  k top pod
No resources found in default namespace.
[devops@DAPDTNZBTXX1001 colortokens]$ k get ns
NAME                                 STATUS   AGE
app                                  Active   96d
cert-manager                         Active   162d
default                              Active   176d
digital-ns                           Active   3d23h
istio-system                         Active   161d
kong-cp                              Active   19d
kong-dev-portal                      Active   19d
kong-dp                              Active   19d
kong-eg-cp                           Active   18d
kong-eg-dp                           Active   18d
kube-node-lease                      Active   176d
kube-public                          Active   176d
kube-system                          Active   176d
monitoring                           Active   22d
nginx-image-store                    Active   20m
nginxplus                            Active   27m
prometheus                           Active   16d
secretgen-controller                 Active   176d
tanzu-system-ingress                 Active   162d
tkg-system                           Active   176d
velero                               Active   4d22h
velero-vsphere-plugin-backupdriver   Active   176d
vmware-system-antrea                 Active   176d
vmware-system-auth                   Active   176d
vmware-system-cloud-provider         Active   176d
vmware-system-csi                    Active   176d
vmware-system-tkg                    Active   176d
[devops@DAPDTNZBTXX1001 colortokens]$ k top pod -n digital-ns
NAME                         CPU(cores)   MEMORY(bytes)
nginx-test-7d87bf7c5-nk4wr   0m           15Mi
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ helm registry login daregistry.bankofbaroda.co.in:9443 -u admin
Password:
Login Succeeded
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ export HELM_EXPERIMENTAL_OCI=1
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ #helm -n ct-system install ct-contsec oci://daregistry.bankofbaroda.co.in:9443/colortokens/helm/ct-contsec --version 24.9.2 --set global.colortokensDomainSuffix=https://colortokensdr.bankofbaroda.co.in --set global.clusterIdentifier=dapdtnzwcxx1001 --set global.colortokensAuthKey=akc99x4w2ak7s --set global.service.classicMode="false" --set global.registryAccount=daregistry.bankofbaroda.co.in:9443/colortokens
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ k get ns
NAME                                 STATUS   AGE
app                                  Active   96d
cert-manager                         Active   162d
default                              Active   176d
digital-ns                           Active   3d23h
istio-system                         Active   161d
kong-cp                              Active   19d
kong-dev-portal                      Active   19d
kong-dp                              Active   19d
kong-eg-cp                           Active   18d
kong-eg-dp                           Active   18d
kube-node-lease                      Active   176d
kube-public                          Active   176d
kube-system                          Active   176d
monitoring                           Active   22d
nginx-image-store                    Active   25m
nginxplus                            Active   31m
prometheus                           Active   16d
secretgen-controller                 Active   176d
tanzu-system-ingress                 Active   162d
tkg-system                           Active   176d
velero                               Active   4d22h
velero-vsphere-plugin-backupdriver   Active   176d
vmware-system-antrea                 Active   176d
vmware-system-auth                   Active   176d
vmware-system-cloud-provider         Active   176d
vmware-system-csi                    Active   176d
vmware-system-tkg                    Active   176d
[devops@DAPDTNZBTXX1001 colortokens]$ k create ns ct-system
namespace/ct-system created
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ k describe ns digital-ns
Name:         digital-ns
Labels:       kubernetes.io/metadata.name=digital-ns
              pod-security.kubernetes.io/enforce=privileged
Annotations:  <none>
Status:       Active

No resource quota.

No LimitRange resource.
[devops@DAPDTNZBTXX1001 colortokens]$ k label ns ct-system --overewrite pod-security.kubernetes.io/enforce=privileged
error: unknown flag: --overewrite
See 'kubectl label --help' for usage.
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ k label ns ct-system --overewrite=pod-security.kubernetes.io/enforce=privileged
error: unknown flag: --overewrite
See 'kubectl label --help' for usage.
[devops@DAPDTNZBTXX1001 colortokens]$ k label ns ct-system --overwrite pod-security.kubernetes.io/enforce=privileged
namespace/ct-system labeled
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ #helm -n ct-system install ct-contsec oci://daregistry.bankofbaroda.co.in:9443/colortokens/helm/ct-contsec --version 24.9.2 --set global.colortokensDomainSuffix=https://colortokensdr.bankofbaroda.co.in --set global.clusterIdentifier=dapdtnzwcxx1001 --set global.colortokensAuthKey=akc99x4w2ak7s --set global.service.classicMode="false" --set global.registryAccount=daregistry.bankofbaroda.co.in:9443/colortokens
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ export HELM_EXPERIMENTAL_OCI=1
[devops@DAPDTNZBTXX1001 colortokens]$ helm -n ct-system install ct-contsec oci://daregistry.bankofbaroda.co.in:9443/colortokens/helm/ct-contsec --version 24.9.2 --set global.colortokensDomainSuffix=https://colortokensdr.bankofbaroda.co.in --set global.clusterIdentifier=dapdtnzwcxx1001 --set global.colortokensAuthKey=4y4vyfbdejteq --set global.service.classicMode="false" --set global.registryAccount=daregistry.bankofbaroda.co.in:9443/colortokens
Pulled: daregistry.bankofbaroda.co.in:9443/colortokens/helm/ct-contsec:24.9.2
Digest: sha256:b1b25cac5838aee756b8f1d2b51131cd5a65d00c5c8e7d4921f84934c5cbfde1
Error: INSTALLATION FAILED: unable to build kubernetes objects from release manifest: [resource mapping not found for name: "ext-authz" namespace: "istio-system" from "": no matches for kind "EnvoyFilter" in version "networking.istio.io/v1alpha3"
ensure CRDs are installed first, resource mapping not found for name: "als-config" namespace: "istio-system" from "": no matches for kind "EnvoyFilter" in version "networking.istio.io/v1alpha3"
ensure CRDs are installed first, resource mapping not found for name: "ct-telemetry" namespace: "ct-system" from "": no matches for kind "Telemetry" in version "telemetry.istio.io/v1alpha1"
ensure CRDs are installed first]
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ cd
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$ ls -lrth
total 11G
drwxr-x--- 4 devops devops   34 Jun 10  2024 remoting
-rw------- 1 devops devops  43K Jun 13  2024 nohup.out
-rwxr-xr-x 1 devops devops 1.4M Jun 15  2024 agent.jar
drwxr-x--- 7 devops devops  151 Jul 12  2024 istio-helm
-rw-r----- 1 devops devops 3.3G Jan 21 11:45 photon-ova-disk1.vmdk
-rw-r----- 1 devops devops 1.9K Jan 21 11:45 photon-ova.cert
-rw-r----- 1 devops devops  185 Jan 21 11:45 photon-ova.mf
-rw-r----- 1 devops devops 112K Jan 21 11:45 photon-ova.ovf
-rw-r----- 1 devops devops 1.4K Jan 21 11:45 item.json
-rw-r----- 1 devops devops 5.1K Jan 21 13:08 additional-ca-secret-set1.yaml
-rw-r----- 1 devops devops 1.3K Jan 21 13:18 DMZ-Workload-Set1.yaml
-rw-r----- 1 devops devops  792 Jan 21 18:13 bashrc.txt
-rw-r----- 1 devops devops 4.0G Jan 28 17:27 controller-22.1.7-9093.pkg
-rw-r----- 1 devops devops 2.6G Jan 31 13:08 BIGIP-17.1.1.3-0.0.5.ALL-vmware.ova
-rw-r----- 1 devops devops 9.6K Jan 31 14:34 lice.txt
-rw-r----- 1 devops devops 9.6K Jan 31 14:34 devops@172.16.87.136
-rw-r----- 1 devops devops 1.8K Feb  4 11:12 bigip-ctlr-deployment.yaml
-rw-r----- 1 devops devops 1.8K Feb  4 11:12 bigip--ctrl-clusterrole.yaml
-rw-r----- 1 devops devops  27M Feb  4 11:12 f5-appsvcs-3.51.0-5.noarch.rpm
-rw-r----- 1 devops devops 1.1K Feb  4 11:12 f5-ipam-controller-deploy.yaml
-rw-r----- 1 devops devops  687 Feb  4 11:12 f5-ipam-ctlr-clusterrole.yaml
-rw-r----- 1 devops devops  20M Feb  4 11:12 f5-telemetry-1.36.0-1.noarch.rpm
-rw-r----- 1 devops devops  49M Feb  4 11:12 helm
-rw-r----- 1 devops devops  18M Feb  4 11:12 imgpkg
-rw-r----- 1 devops devops  84M Feb  4 11:12 tanzu
-rw-r----- 1 devops devops 9.9M Feb  4 11:12 yq
-rw-r----- 1 devops devops  41K Feb  4 11:49 cis-customresourcedefinitions.yaml
drwxr-x--- 2 devops devops 4.0K Feb  4 11:49 f5-set1
-rw-r----- 1 devops devops 2.8K Feb  4 12:06 jfrog.crt
-rw-r----- 1 devops devops  519 Feb  4 15:14 1
-rw-r----- 1 devops devops 1.1M Feb  4 16:38 istio-helm.tar
-rw-r----- 1 devops devops 3.0K Feb 13 15:14 supervisor-namespace.kubeconfig
-rw-r----- 1 devops devops 4.3K Feb 13 15:14 cluster-autoscaler-supervisor-config-secret.yaml
-rw-r----- 1 devops devops  408 Feb 13 15:15 overlay-secret.yaml
-rw-r----- 1 devops devops 1.3K Apr  9 17:02 app.yaml
-rw-r----- 1 devops devops 4.5K May  9 10:09 avi.txt
-rw-r----- 1 devops devops 5.1K May  9 10:38 addition-ca.yaml
drwxr-x--- 2 devops devops  104 May  9 13:09 Set1file
-rw-r----- 1 devops devops 3.9K May  9 14:28 kapp-controller-config.yaml
-rw-r----- 1 devops devops  519 May  9 14:38 contour-data-values.yaml
-rw-r----- 1 devops devops  12K May  9 17:55 dapdtnzwcxx1002_v1.27.11+vmware.1-fips.1.yaml
-rw-r----- 1 devops devops  14K May  9 18:43 dapdtnzwcxx1002_v1.28.8+vmware.1-fips.1.yaml
-rw-r----- 1 devops devops  13K May 13 11:28 dapdtnzwcxx1001_v1.27.11+vmware.1-fips.1.yaml
-rw-r----- 1 devops devops  15K May 13 12:01 dapdtnzwcxx1001_v1.28.8+vmware.1-fips.1.yaml
-rw-r----- 1 devops devops  15K May 13 12:46 dapdtnzwcxx1001_v1.29.4+vmware.3-fips.1.yaml
-rw-r----- 1 devops devops  15K May 13 13:32 dapdtnzwcxx1001_v1.30.1+vmware.1-fips.yaml
-rw-r----- 1 devops devops  14K May 13 13:45 dapdtnzwcxx1002_v1.29.4+vmware.3-fips.1.yaml
-rw-r----- 1 devops devops  14K May 13 14:35 dapdtnzwcxx1002_v1.30.1+vmware.1-fips.yaml
-rw-r----- 1 devops devops  19K May 14 11:16 dapdtnzwcxx1001.2025-0514_11-16-15.txt
-rw-r----- 1 devops devops  18K May 14 11:17 dapdtnzwcxx1002.2025-0514_11-17-01.txt
-rw-r----- 1 devops devops  18K May 14 11:18 dapdtnzwcxx1002.2025-0514_11-17-54.txt
-rwxr--r-- 1 devops devops 4.1K May 14 11:18 cluster-health.sh
-rw-r----- 1 devops devops  18K May 14 11:18 dapdtnzwcxx1002.2025-0514_11-18-54.txt
drwxr-x--- 2 devops devops    6 May 14 11:27 cluster-health
-rw-r----- 1 devops devops  18K May 14 11:27 dapdtnzwcxx1002.2025-0514_11-27-09.txt
-rw------- 1 devops devops  352 May 16 14:53 values.yaml
drwxrwxrwx 2 devops devops   22 May 16 15:35 autoscaler
-rw-r----- 1 devops devops 5.8K May 19 17:45 contour.yaml
-rw-r----- 1 devops devops  13K May 19 17:54 contur-secret.yaml
drwxr-x--- 2 devops devops  130 May 20 12:59 dmz_app_Validation
drwxr-x--- 2 devops devops   76 Jun 23 11:36 veloro
-rw-r----- 1 devops devops 1.9K Jun 24 15:19 node-exporter.yaml
drwxr-x--- 2 devops devops  108 Jun 27 19:18 redis
-rw-r----- 1 devops devops 3.4K Jun 28 18:23 edbcert.cer
drwxr-x--- 2 devops devops   20 Jun 28 18:51 drkong
-rw-r----- 1 devops devops 9.5K Jun 30 14:08 contoursecret.yaml
-rw-r----- 1 devops devops  323 Jun 30 14:10 kong-proxy.yaml
-rw-r----- 1 devops devops  313 Jun 30 14:11 kong-proxy-eg.yaml
drwxr-x--- 2 devops devops   69 Jul  2 11:58 node_cadvisor_deploy_file
drwxr-xr-x 2 devops devops  166 Jul  2 12:07 node_exporter
drwxr-x--- 2 devops devops  172 Jul  2 17:37 prometheus
drwxr-x--- 2 devops devops   55 Jul  2 18:53 cadvisor
drwxr-x--- 2 devops devops  124 Jul  2 20:09 kube-state-metrics
-rw-r----- 1 devops devops  26M Jul  8 17:42 istio-1.25.2-linux-amd64.tar.gz
-rw-r----- 1 devops devops 450M Jul 10 13:05 velero.tar
-rw-r----- 1 devops devops 190M Jul 11 14:48 velero_v1.15.2_vmware.1.tar
-rw-r----- 1 devops devops 112M Jul 11 14:48 velero-plugin-for-aws_v1.11.1_vmware.1.tar
-rw-r----- 1 devops devops  93M Jul 11 14:48 velero-v1.15.2-linux-arm64.tar
drwxrwxrwx 2 devops devops   59 Jul 11 16:58 minio
drwxr-x--- 4 devops devops 4.0K Jul 12 19:06 velero-v1.15.2
-rw-r----- 1 devops devops 1.1K Jul 14 11:58 f5_pvc_old.yaml
-rw-r----- 1 devops devops  459 Jul 14 12:24 f5_pvc.yaml
-rw-r----- 1 devops devops  221 Jul 14 12:40 f5-pvc.yaml
drwxr-x--- 2 devops devops 4.0K Jul 14 12:51 f5-set2
drwx------ 5 devops devops 4.0K Jul 14 13:37 kong-prod-egress
drwx------ 8 devops devops 4.0K Jul 14 15:05 kong-prod
drwxr-x--- 2 devops devops   28 Jul 15 16:53 colortokens
-rw-r----- 1 devops devops  217 Jul 16 14:02 test-pvc.yaml
[devops@DAPDTNZBTXX1001 ~]$ cd /tmp/
[devops@DAPDTNZBTXX1001 tmp]$
[devops@DAPDTNZBTXX1001 tmp]$
[devops@DAPDTNZBTXX1001 tmp]$
[devops@DAPDTNZBTXX1001 tmp]$ ls -lrth
total 142M
drwxr-x--- 6 devops devops  115 Apr 11 20:27 istio-1.25.2
drwx------ 3 root   root     17 Jun 26 17:20 systemd-private-797f8f7ab695491ab773f5a128972a42-dbus-broker.service-t5ZPRN
drwx------ 3 root   root     17 Jun 26 17:20 systemd-private-797f8f7ab695491ab773f5a128972a42-chronyd.service-Cb5ypq
drwx------ 3 root   root     17 Jun 26 17:20 systemd-private-797f8f7ab695491ab773f5a128972a42-systemd-logind.service-StSRrW
drwx------ 3 root   root     17 Jun 26 17:20 systemd-private-797f8f7ab695491ab773f5a128972a42-kdump.service-KRRFdt
drwxr-x--- 2 devops devops   18 Jun 26 17:20 hsperfdata_devops
-rw-r--r-- 1 devops devops  26M Jul  8 17:42 istio-1.25.2-linux-amd64.tar.gz
-rw-r----- 1 devops devops  24M Jul 11 15:13 velero-linux-v1.15.2+vmware.1.gz
-rw------- 1 devops devops 1.9K Jul 11 17:33 kubectl-edit-3446534883.yaml
-rw------- 1 devops devops 4.2K Jul 11 17:33 kubectl-edit-1268201763.yaml
-rw------- 1 devops devops 2.0K Jul 11 17:35 kubectl-edit-2316428491.yaml
-rw------- 1 devops devops 4.2K Jul 11 17:35 kubectl-edit-331904086.yaml
-rw-r----- 1 devops devops  93M Jul 15 15:59 istioctl
-rw-rw-r-- 1 root   tm_dsa    0 Jul 16 00:17 TRXHANDLER_ROLL.lck
-rw-rw-r-- 1 root   tm_dsa    0 Jul 16 00:17 ICRC_ROLL.lck
drwx------ 2 devops devops 4.0K Jul 16 15:31 nginx-plus
[devops@DAPDTNZBTXX1001 tmp]$ cd istio-1.25.2/
[devops@DAPDTNZBTXX1001 istio-1.25.2]$
[devops@DAPDTNZBTXX1001 istio-1.25.2]$
[devops@DAPDTNZBTXX1001 istio-1.25.2]$ ls -lrth
total 28K
drwxr-x---  3 devops devops   57 Apr 11 20:27 tools
drwxr-x--- 27 devops devops 4.0K Apr 11 20:27 samples
-rw-r-----  1 devops devops 6.8K Apr 11 20:27 README.md
-rw-r-----  1 devops devops  983 Apr 11 20:27 manifest.yaml
drwxr-x---  4 devops devops   36 Apr 11 20:27 manifests
-rw-r-----  1 devops devops  12K Apr 11 20:27 LICENSE
drwxr-x---  2 devops devops   22 Apr 11 20:27 bin
[devops@DAPDTNZBTXX1001 istio-1.25.2]$
[devops@DAPDTNZBTXX1001 istio-1.25.2]$
[devops@DAPDTNZBTXX1001 istio-1.25.2]$
[devops@DAPDTNZBTXX1001 istio-1.25.2]$ cd manifests/
[devops@DAPDTNZBTXX1001 manifests]$
[devops@DAPDTNZBTXX1001 manifests]$
[devops@DAPDTNZBTXX1001 manifests]$ cd charts/
[devops@DAPDTNZBTXX1001 charts]$
[devops@DAPDTNZBTXX1001 charts]$
[devops@DAPDTNZBTXX1001 charts]$
[devops@DAPDTNZBTXX1001 charts]$ ls
base  default  gateway  gateways  install-OpenShift.md  istio-cni  istio-control  README.md  UPDATING-CHARTS.md  ztunnel
[devops@DAPDTNZBTXX1001 charts]$
[devops@DAPDTNZBTXX1001 charts]$
[devops@DAPDTNZBTXX1001 charts]$ cd base/
[devops@DAPDTNZBTXX1001 base]$
[devops@DAPDTNZBTXX1001 base]$
[devops@DAPDTNZBTXX1001 base]$
[devops@DAPDTNZBTXX1001 base]$ ls
Chart.yaml  files  README.md  templates  values.yaml
[devops@DAPDTNZBTXX1001 base]$ vi values.yaml
[devops@DAPDTNZBTXX1001 base]$
[devops@DAPDTNZBTXX1001 base]$
[devops@DAPDTNZBTXX1001 base]$
[devops@DAPDTNZBTXX1001 base]$ cd files/
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$ ls
crd-all.gen.yaml                         profile-compatibility-version-1.23.yaml  profile-platform-gke.yaml  profile-platform-microk8s.yaml   profile-preview.yaml
profile-ambient.yaml                     profile-compatibility-version-1.24.yaml  profile-platform-k3d.yaml  profile-platform-minikube.yaml   profile-remote.yaml
profile-compatibility-version-1.22.yaml  profile-demo.yaml                        profile-platform-k3s.yaml  profile-platform-openshift.yaml  profile-stable.yaml
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$ k apply -f crd-all.gen.yaml
customresourcedefinition.apiextensions.k8s.io/wasmplugins.extensions.istio.io created
customresourcedefinition.apiextensions.k8s.io/destinationrules.networking.istio.io created
customresourcedefinition.apiextensions.k8s.io/envoyfilters.networking.istio.io created
customresourcedefinition.apiextensions.k8s.io/gateways.networking.istio.io created
customresourcedefinition.apiextensions.k8s.io/proxyconfigs.networking.istio.io created
customresourcedefinition.apiextensions.k8s.io/serviceentries.networking.istio.io created
customresourcedefinition.apiextensions.k8s.io/sidecars.networking.istio.io created
customresourcedefinition.apiextensions.k8s.io/virtualservices.networking.istio.io created
customresourcedefinition.apiextensions.k8s.io/workloadentries.networking.istio.io created
customresourcedefinition.apiextensions.k8s.io/workloadgroups.networking.istio.io created
customresourcedefinition.apiextensions.k8s.io/authorizationpolicies.security.istio.io created
customresourcedefinition.apiextensions.k8s.io/peerauthentications.security.istio.io created
customresourcedefinition.apiextensions.k8s.io/requestauthentications.security.istio.io created
customresourcedefinition.apiextensions.k8s.io/telemetries.telemetry.istio.io created
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$
[devops@DAPDTNZBTXX1001 files]$ cd
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$ helm -n ct-system install ct-contsec oci://daregistry.bankofbaroda.co.in:9443/colortokens/helm/ct-contsec --version 24.9.2 --set global.colortokensDomainSuffix=https://colortokensdr.bankofbaroda.co.in --set global.clusterIdentifier=dapdtnzwcxx1001 --set global.colortokensAuthKey=4y4vyfbdejteq --set global.service.classicMode="false" --set global.registryAccount=daregistry.bankofbaroda.co.in:9443/colortokens
Pulled: daregistry.bankofbaroda.co.in:9443/colortokens/helm/ct-contsec:24.9.2
Digest: sha256:b1b25cac5838aee756b8f1d2b51131cd5a65d00c5c8e7d4921f84934c5cbfde1
NAME: ct-contsec
LAST DEPLOYED: Wed Jul 16 15:56:28 2025
NAMESPACE: ct-system
STATUS: deployed
REVISION: 1
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$ k get po -n ct-system
NAME                                   READY   STATUS     RESTARTS   AGE
admission-controller-559ddddbc-rjll7   1/1     Running    0          15s
collector-64c69c9f55-5st5h             0/1     Init:0/1   0          15s
policy-6dbdb88c8b-9lql2                1/1     Running    0          15s
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$ kubectl edit configmap istio -n istio-system
configmap/istio edited
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$ k rollout restart deployment -n istio-system
deployment.apps/istio-egressgateway restarted
deployment.apps/istio-ingressgateway restarted
deployment.apps/istiod restarted
[devops@DAPDTNZBTXX1001 ~]$ kubectl label namespace digital-ns istio-injection=enabled ct-enforcement=enabled
namespace/digital-ns labeled
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$ kubectl rollout restart deploy -n digital-ns
deployment.apps/nginx-test restarted
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$ k get po -n ct-system
NAME                                   READY   STATUS    RESTARTS   AGE
admission-controller-559ddddbc-rjll7   1/1     Running   0          15m
collector-64c69c9f55-5st5h             1/1     Running   0          15m
collector-64c69c9f55-5wqp7             1/1     Running   0          14m
collector-64c69c9f55-wr4hc             1/1     Running   0          14m
policy-6dbdb88c8b-9lql2                1/1     Running   0          15m
[devops@DAPDTNZBTXX1001 ~]$ k get po -n digital-ns
NAME                         READY   STATUS     RESTARTS   AGE
nginx-test-7d87bf7c5-nk4wr   1/1     Running    0          4d
nginx-test-84f5d5767-5vszg   0/3     Init:0/1   0          22s
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$
[devops@DAPDTNZBTXX1001 ~]$ k get po -n digital-ns
NAME                         READY   STATUS     RESTARTS   AGE
nginx-test-7d87bf7c5-nk4wr   1/1     Running    0          4d
nginx-test-84f5d5767-5vszg   0/3     Init:0/1   0          31s
[devops@DAPDTNZBTXX1001 ~]$ k get po -n digital-ns
NAME                         READY   STATUS     RESTARTS   AGE
nginx-test-7d87bf7c5-nk4wr   1/1     Running    0          4d
nginx-test-84f5d5767-5vszg   0/3     Init:0/1   0          32s
[devops@DAPDTNZBTXX1001 ~]$ k get po -n digital-ns
NAME                         READY   STATUS     RESTARTS   AGE
nginx-test-7d87bf7c5-nk4wr   1/1     Running    0          4d
nginx-test-84f5d5767-5vszg   0/3     Init:0/1   0          33s
[devops@DAPDTNZBTXX1001 ~]$ k describe po -n digital-ns
Name:             nginx-test-7d87bf7c5-nk4wr
Namespace:        digital-ns
Priority:         0
Service Account:  default
Node:             dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-pqn54/172.17.136.135
Start Time:       Sat, 12 Jul 2025 15:59:43 +0530
Labels:           app=nginx
                  pod-template-hash=7d87bf7c5
                  velero.io/backup-name=digital-ns-backup
                  velero.io/restore-name=digital-ns-backup-20250712155942
Annotations:      <none>
Status:           Running
IP:               192.101.4.50
IPs:
  IP:           192.101.4.50
Controlled By:  ReplicaSet/nginx-test-7d87bf7c5
Containers:
  nginx:
    Container ID:   containerd://afece511d4d1000f76e51e28871c45945ac9dba430a822f918db0aa072c822cd
    Image:          danmjfgwnxx0001.bankofbaroda.co.in:9443/nginx/nginx:v1
    Image ID:       danmjfgwnxx0001.bankofbaroda.co.in:9443/nginx/nginx@sha256:01a08268517933edd22283f4d88a8afadd4e6351be3b4d868dd177d14ef56a7e
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Sat, 12 Jul 2025 15:59:44 +0530
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-54f5m (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True
  Initialized                 True
  Ready                       True
  ContainersReady             True
  PodScheduled                True
Volumes:
  kube-api-access-54f5m:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:                      <none>


Name:             nginx-test-84f5d5767-5vszg
Namespace:        digital-ns
Priority:         0
Service Account:  default
Node:             dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-h9wtn/172.17.136.139
Start Time:       Wed, 16 Jul 2025 16:11:31 +0530
Labels:           app=nginx
                  ct-cluster-identifier=dapdtnzwcxx1001
                  ct-enforcement=enabled
                  pod-template-hash=84f5d5767
                  security.istio.io/tlsMode=istio
                  service.istio.io/canonical-name=nginx
                  service.istio.io/canonical-revision=latest
Annotations:      istio.io/rev: default
                  kubectl.kubernetes.io/default-container: nginx
                  kubectl.kubernetes.io/default-logs-container: nginx
                  kubectl.kubernetes.io/restartedAt: 2025-07-16T16:11:31+05:30
                  prometheus.io/path: /stats/prometheus
                  prometheus.io/port: 15020
                  prometheus.io/scrape: true
                  sidecar.istio.io/status:
                    {"initContainers":["istio-init"],"containers":["istio-proxy"],"volumes":["workload-socket","credential-socket","workload-certs","istio-env...
Status:           Pending
IP:
IPs:              <none>
Controlled By:    ReplicaSet/nginx-test-84f5d5767
Init Containers:
  istio-init:
    Container ID:
    Image:         docker.io/istio/proxyv2:1.25.2
    Image ID:
    Port:          <none>
    Host Port:     <none>
    Args:
      istio-iptables
      -p
      15001
      -z
      15006
      -u
      1337
      -m
      REDIRECT
      -i
      *
      -x

      -b
      *
      -d
      15090,15021,15020
      --log_output_level=default:info
    State:          Waiting
      Reason:       PodInitializing
    Ready:          False
    Restart Count:  0
    Limits:
      cpu:     2
      memory:  1Gi
    Requests:
      cpu:        100m
      memory:     128Mi
    Environment:  <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-82pkf (ro)
Containers:
  nginx:
    Container ID:
    Image:          danmjfgwnxx0001.bankofbaroda.co.in:9443/nginx/nginx:v1
    Image ID:
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Waiting
      Reason:       PodInitializing
    Ready:          False
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-82pkf (ro)
  istio-proxy:
    Container ID:
    Image:         docker.io/istio/proxyv2:1.25.2
    Image ID:
    Port:          15090/TCP
    Host Port:     0/TCP
    Args:
      proxy
      sidecar
      --domain
      $(POD_NAMESPACE).svc.cluster.local
      --proxyLogLevel=warning
      --proxyComponentLogLevel=misc:error
      --log_output_level=default:info
    State:          Waiting
      Reason:       PodInitializing
    Ready:          False
    Restart Count:  0
    Limits:
      cpu:     2
      memory:  1Gi
    Requests:
      cpu:      100m
      memory:   128Mi
    Readiness:  http-get http://:15021/healthz/ready delay=0s timeout=3s period=15s #success=1 #failure=4
    Startup:    http-get http://:15021/healthz/ready delay=0s timeout=3s period=1s #success=1 #failure=600
    Environment:
      PILOT_CERT_PROVIDER:           istiod
      CA_ADDR:                       istiod.istio-system.svc:15012
      POD_NAME:                      nginx-test-84f5d5767-5vszg (v1:metadata.name)
      POD_NAMESPACE:                 digital-ns (v1:metadata.namespace)
      INSTANCE_IP:                    (v1:status.podIP)
      SERVICE_ACCOUNT:                (v1:spec.serviceAccountName)
      HOST_IP:                        (v1:status.hostIP)
      ISTIO_CPU_LIMIT:               2 (limits.cpu)
      PROXY_CONFIG:                  {"tracing":{"zipkin":{"address":"zipkin.istio-system:9411"}},"extraStatTags":["request_method","request_path"]}

      ISTIO_META_POD_PORTS:          [
                                         {"containerPort":80,"protocol":"TCP"}
                                     ]
      ISTIO_META_APP_CONTAINERS:     nginx
      GOMEMLIMIT:                    1073741824 (limits.memory)
      GOMAXPROCS:                    2 (limits.cpu)
      ISTIO_META_CLUSTER_ID:         Kubernetes
      ISTIO_META_NODE_NAME:           (v1:spec.nodeName)
      ISTIO_META_INTERCEPTION_MODE:  REDIRECT
      ISTIO_META_WORKLOAD_NAME:      nginx-test
      ISTIO_META_OWNER:              kubernetes://apis/apps/v1/namespaces/digital-ns/deployments/nginx-test
      ISTIO_META_MESH_ID:            cluster.local
      TRUST_DOMAIN:                  cluster.local
    Mounts:
      /etc/istio/pod from istio-podinfo (rw)
      /etc/istio/proxy from istio-envoy (rw)
      /var/lib/istio/data from istio-data (rw)
      /var/run/secrets/credential-uds from credential-socket (rw)
      /var/run/secrets/istio from istiod-ca-cert (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-82pkf (ro)
      /var/run/secrets/tokens from istio-token (rw)
      /var/run/secrets/workload-spiffe-credentials from workload-certs (rw)
      /var/run/secrets/workload-spiffe-uds from workload-socket (rw)
  opa-istio:
    Container ID:
    Image:         daregistry.bankofbaroda.co.in:9443/colortokens/openpolicyagent/opa:0.63.0-istio-4-rootless
    Image ID:
    Port:          <none>
    Host Port:     <none>
    Args:
      run
      --server
      --disable-telemetry
      --config-file=/config/config.yaml
      --addr=localhost:8181
      --log-level=info
      --diagnostic-addr=0.0.0.0:8282
      /policy/policy.rego
    State:          Waiting
      Reason:       PodInitializing
    Ready:          False
    Restart Count:  0
    Liveness:       tcp-socket :8282 delay=0s timeout=1s period=10s #success=1 #failure=3
    Environment:
      POD_IP:   (v1:status.podIP)
    Mounts:
      /config from opa-istio-config (rw)
      /policy from opa-policy (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-82pkf (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   False
  Initialized                 False
  Ready                       False
  ContainersReady             False
  PodScheduled                True
Volumes:
  workload-socket:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:  <unset>
  credential-socket:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:  <unset>
  workload-certs:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:  <unset>
  istio-envoy:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:     Memory
    SizeLimit:  <unset>
  istio-data:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:  <unset>
  istio-podinfo:
    Type:  DownwardAPI (a volume populated by information about the pod)
    Items:
      metadata.labels -> labels
      metadata.annotations -> annotations
  istio-token:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  43200
  istiod-ca-cert:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      istio-ca-root-cert
    Optional:  false
  kube-api-access-82pkf:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
  opa-istio-config:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      opa-istio-config
    Optional:  false
  opa-policy:
    Type:        ConfigMap (a volume populated by a ConfigMap)
    Name:        opa-policy
    Optional:    false
QoS Class:       Burstable
Node-Selectors:  <none>
Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  44s   default-scheduler  Successfully assigned digital-ns/nginx-test-84f5d5767-5vszg to dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-h9wtn
  Normal  Pulling    43s   kubelet            Pulling image "docker.io/istio/proxyv2:1.25.2"
[devops@DAPDTNZBTXX1001 ~]$






[devops@DAPDTNZBTXX1001 ~]$ k top no
NAME                                            CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
dapdtnzwcxx1001-jdjbs-22c97                     304m         3%     3406Mi          5%
dapdtnzwcxx1001-jdjbs-67dtt                     178m         2%     2852Mi          4%
dapdtnzwcxx1001-jdjbs-zgkc7                     171m         2%     2618Mi          4%
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-dns5n   258m         1%     5971Mi          13%
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-h9wtn   1190m        4%     4917Mi          11%
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-pqn54   211m         0%     4384Mi          10%
dapdtnzwcxx1001-node-pool-1-ctkcd-cdwbr-tbrrq   160m         0%     3706Mi          8%
[devops@DAPDTNZBTXX1001 ~]$ k top po -n digital-ns
NAME                         CPU(cores)   MEMORY(bytes)
nginx-test-84f5d5767-xm2jb   4m           68Mi
[devops@DAPDTNZBTXX1001 ~]$












======================Create test ns ======================

Take sample yaml from istio dir and we can apply in new new name space for


[devops@DAPDTNZBTXX1001 colortokens]$ k create ns test-ct
namespace/test-ct created
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ k describe ns digital-ns
Name:         digital-ns
Labels:       ct-enforcement=enabled
              istio-injection=enabled
              kubernetes.io/metadata.name=digital-ns
              pod-security.kubernetes.io/enforce=privileged
Annotations:  <none>
Status:       Active

No resource quota.

No LimitRange resource.
[devops@DAPDTNZBTXX1001 colortokens]$ k label ns test-ct --overwrite pod-security.kubernetes.io/enforce=privileged
namespace/test-ct labeled
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ vi sample.yaml
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ k apply -f sample.yaml -n test-ct
serviceaccount/sleep created
service/sleep created
deployment.apps/sleep created
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$ kubectl label namespace test-ct istio-injection=enabled ct-enforcement=enabled
namespace/test-ct labeled
[devops@DAPDTNZBTXX1001 colortokens]$ kubectl rollout restart deploy -n test-ct
deployment.apps/sleep restarted
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$
[devops@DAPDTNZBTXX1001 colortokens]$




=======================Install Colortoken on TKg Envirnment ======================

steps 1: You need to have root privileges, helm and kubectl installed to run the below commands in the Terminal

steps 2: Please use a cluster identifier that has not been previously used in this tenant. If the installation fails due to an invalid cluster identifier, please run 
helm -n ct-system uninstall ct-contsec --no-hooks
 and then install again.

 Steps 3: Kubernetes 1.21+ using Istio 1.18+, Azure AKS, GCP GKE and AWS EKS are supported. Note that Istio 1.18+ to latest(excluding ambient mesh) supported.

 Steps 4: Use Local Registry login

 helm registry login daregistry.bankofbaroda.co.in:9443 -u admin

 Step 5: Please ensure cluster name and Application namespace

 Steps 6: $ kubectl create namespace ct-system

  k label ns ct-system --overwrite pod-security.kubernetes.io/enforce=privileged

  Steps 7:  ##Install the ct-contsec helm chart

  $ export HELM_EXPERIMENTAL_OCI=1

$ helm -n ct-system install ct-contsec oci://colortokenspublic.azurecr.io/helm/ct-contsec --version 24.9.2 --set global.colortokensDomainSuffix=https://colortokens.bankofbaroda.co.in --set global.clusterIdentifier=dapmtnzwcxx0001 --set global.colortokensAuthKey=akc99x4w2ak7s --set global.service.classicMode="false" --set global.registryAccount=daregistry.bankofbaroda.co.in:9443


Steps 8: ##To integrate Istio with ColorTokens Collector, edit the Istio configmap and modify the mesh config under data section

Editable parameter on cm of istio.


  data:
    mesh: |-
      accessLogEncoding: JSON
      defaultConfig:
        discoveryAddress: istiod.istio-system.svc:15012
        extraStatTags:
        - request_method
        - request_path
        tracing:
          zipkin:
            address: zipkin.istio-system:9411
      enableEnvoyAccessLogService: true
      extensionProviders:
      - envoyHttpAls:
          port: 9999
          service: collector.ct-system.svc.cluster.local
        name: ct-http-als
      - envoyTcpAls:
          port: 9999
          service: collector.ct-system.svc.cluster.local
        name: ct-tcp-als
      enablePrometheusMerge: true
      rootNamespace: istio-system
      trustDomain: cluster.local
    meshNetworks: 'networks: {}'

$ kubectl edit configmap istio -n istio-system

Edited  CM  ===============>>>>>>>>>>>

apiVersion: v1
data:
  mesh: |-
    accessLogEncoding: JSON
    defaultConfig:
      discoveryAddress: istiod.istio-system.svc:15012
        extraStatTags:
        - request_method
        - request_path
        tracing:
          zipkin:
            address: zipkin.istio-system:9411
      enableEnvoyAccessLogService: true
      extensionProviders:
      - envoyHttpAls:
          port: 9999
          service: collector.ct-system.svc.cluster.local
        name: ct-http-als
      - envoyTcpAls:
          port: 9999
          service: collector.ct-system.svc.cluster.local
        name: ct-tcp-als
    defaultProviders:
      metrics:
      - prometheus
    enablePrometheusMerge: true
    rootNamespace: istio-system
    trustDomain: cluster.local
  meshNetworks: 'networks: {}'
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: istio
    meta.helm.sh/release-namespace: istio-system
  creationTimestamp: "2025-02-04T12:03:09Z"
  labels:
    app.kubernetes.io/instance: istio
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: istiod
    app.kubernetes.io/part-of: istio
    app.kubernetes.io/version: 1.25.2
    helm.sh/chart: istiod-1.25.2
    install.operator.istio.io/owning-resource: unknown
    istio.io/rev: default
    operator.istio.io/component: Pilot
    release: istio
  name: istio
  namespace: istio-system
  resourceVersion: "71486351"
  uid: b9967087-cbe7-439d-9409-5d98d345cf84
~


Steps 9:  ##Restart Istio pods to load new config

$ kubectl -n istio-system rollout restart deploy


Steps 10 :
======================= Enforce target namespace   ============================

Please ensure that the ColorTokens services are up and running by verifying the output of the command kubectl -n ct-system get pods

 before proceeding.

##Inject Istio and OPA sidecars on target namespace

$ kubectl label namespace digital-ns istio-injection=enabled ct-enforcement=enable


##Restart the deployments in target namespace for sidecar injection

$ kubectl rollout restart deploy -n digital-ns
